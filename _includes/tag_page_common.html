{% unless page.tagged.modules.size > 0 %}
  {% assign tagged_module_pages = "" | split: "|" %}
  {% for module_page in site.modules %}
    {% if module_page.tags contains page.tag %}
      {% assign tagged_module_pages = tagged_module_pages | push: module_page %}
    {% endif %}
  {% endfor %}
{% endunless %}

{% unless page.tagged.posts.size > 0 %}
  {% assign tagged_posts = "" | split: "|" %}
  {% for post_page in site.posts %}
    {% if post_page.tags contains page.tag %}
      {% assign tagged_posts = tagged_posts | push: post_page %}
    {% endif %}
  {% endfor %}
{% endunless %}

{% comment %}

Post data:

categories: [] (0)
collection: "posts"
content: "↵"
date: "2017-09-20 00:00:00 +0300"
description: "Ipsum dolor sit amet"
draft: false
excerpt: "↵"
ext: ".md"
id: "/2017/09/20/dc-dc-stepdown"
image: "assets/images/pic01.jpg"
lang: "ru"
layout: "post"
path: "_posts/2017-9-20-dc-dc-stepdown.md"

{% endcomment %}

<!-- we shouldn't have such page if no tag exists -->
{% if tagged_module_pages.size > 0 %}
{{ tagged_module_pages.size }} modules
{% endif %}
{% if tagged_posts.size > 0 %}
{{ tagged_posts.size }} posts
{% endif %}
tagged with <strong>{{ page.tag }}</strong>:

<ul>
  {% for t_module_page in tagged_module_pages %}
  <li><a href="{{ site.baseurl }}{{ t_module_page.url }}">{{ t_module_page.module.name }}</a> {{ t_module_page.collection }}</li>
  {% endfor %}
  <li></li>
  {% for t_post in tagged_posts %}
  <li><a href="{{ site.baseurl }}{{ t_post.url }}">{{ t_post.title }}</a> {{ t_post.collection }}</li>
  {% endfor %}
</ul>
